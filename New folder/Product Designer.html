<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anajak POD Designer Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ci: {
                            blue: '#3973b2',
                            yellow: '#fec91b',
                            red: '#e72f27',
                            dark: '#0f172a',
                        },
                        success: '#10b981',
                        light: '#f9fafb',
                    }
                },
                fontFamily: {
                    sans: ['Noto Sans Thai', 'sans-serif'],
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            background-color: #f8fafc;
            overflow: hidden;
        }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .editor-shell {
            background: radial-gradient(circle at top, rgba(57, 115, 178, 0.08), transparent 55%);
        }

        .editor-header {
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(241, 245, 249, 0.8);
        }

        .header-progress-bar {
            position: relative;
            display: block;
            height: 4px;
            border-radius: 9999px;
            background: rgba(255, 255, 255, 0.35);
            overflow: hidden;
        }
        .header-progress-bar span {
            position: absolute;
            inset: 0;
            width: 80%;
            border-radius: inherit;
            background: linear-gradient(90deg, #fec91b, #ffffff);
        }

        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.35rem 0.85rem;
            border-radius: 9999px;
            background: rgba(15, 23, 42, 0.2);
            color: #f8fafc;
        }

        .header-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.25rem;
            color: rgba(248, 250, 252, 0.85);
            font-size: 0.85rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.4rem 0.8rem;
            border-radius: 0.75rem;
            background: rgba(15, 23, 42, 0.18);
        }

        .meta-item span {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        
        /* [CHANGED] Main Layout (Full Height) */
        .editor-layout {
            display: grid;
            grid-template-columns: 80px 320px 1fr 320px; 
            height: 100%; /* allow room for the top header */
            min-height: 0;
        }

        .panel-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: #1f2937;
        }

        .panel-subtitle {
            font-size: 0.75rem;
            color: #64748b;
        }

        /* [NEW] Main Canvas Layout */
        .canvas-layout {
            display: grid;
            grid-template-rows: auto 1fr auto; /* Toolbar, Canvas, Footer */
            height: 100%;
        }

        .canvas-stage {
            background: repeating-linear-gradient(
                45deg,
                rgba(148, 163, 184, 0.08),
                rgba(148, 163, 184, 0.08) 12px,
                transparent 12px,
                transparent 24px
            );
            border: 1px solid #e2e8f0;
            border-radius: 1.25rem;
            padding: 2.5rem;
        }

        .stage-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.92);
            border-radius: 1rem;
            box-shadow: inset 0 1px 0 rgba(148, 163, 184, 0.18);
            position: relative;
            overflow: visible;
        }

        .annotation-badge {
            position: absolute;
            top: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
            background: rgba(57, 115, 178, 0.12);
            color: #0f172a;
            backdrop-filter: blur(6px);
        }

        .tool-nav-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem 0.5rem;
            width: 100%;
            border-radius: 0.75rem;
            color: #475569; 
            transition: all 0.2s ease-in-out;
        }
        .tool-nav-button:hover {
            background-color: #f8fafc; 
        }
        .tool-nav-button.active {
            background-color: #f1f5f9; 
            color: #3973b2; 
            font-weight: 600;
        }

        /* Hide content panels by default */
        .tool-panel { display: none; }
        .tool-panel.active { display: block; }

        /* Mockup Area */
        #print-area {
            position: absolute;
            width: 45%; 
            height: 60%; 
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            border: 2px dashed rgba(57, 115, 178, 0.5);
            transition: border 0.3s;
        }
        #print-area:hover {
            border-color: #3973b2;
        }

        /* Draggable Element (Demo) */
        #design-element {
            position: absolute;
            top: 50px;
            left: 50px;
            width: 150px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: #334155;
            user-select: none;
            /* [NEW] Add border to selected element */
            border: 2px solid #3973b2;
            padding: 10px;
            background: rgba(57, 115, 178, 0.1);
        }
        /* [NEW] Resize handles (more like target image) */
        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border: 2px solid #3973b2;
            border-radius: 50%;
        }
        .resize-handle.bottom-right { bottom: -7px; right: -7px; cursor: se-resize; }
        .resize-handle.top-left { top: -7px; left: -7px; cursor: nw-resize; }
        .resize-handle.top-right { top: -7px; right: -7px; cursor: ne-resize; }
        .resize-handle.bottom-left { bottom: -7px; left: -7px; cursor: sw-resize; }

        /* [NEW] Contextual Toolbar (Fixed at top of canvas) */
        .context-toolbar {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* gap-2 */
            padding: 0.75rem; /* p-3 */
            background: white;
            border-bottom: 1px solid #e2e8f0; /* slate-200 */
            width: 100%;
            flex-shrink: 0;
            z-index: 20;
        }
        .context-toolbar-button {
            padding: 0.5rem; /* p-2 */
            border-radius: 0.5rem; /* rounded-lg */
            color: #475569; /* slate-600 */
            height: 40px; 
            display: flex; 
            align-items: center; 
        }
        .context-toolbar-button:hover,
        .context-toolbar-dropdown:hover {
            background-color: #f1f5f9; /* slate-100 */
        }

        .context-toolbar-button.active-state {
            background-color: rgba(57, 115, 178, 0.12);
            color: #0f172a;
        }

        .context-toolbar-button .badge {
            margin-left: 0.4rem;
            padding: 0.05rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 600;
            background: rgba(15, 23, 42, 0.08);
        }
        .context-toolbar-dropdown,
        .context-toolbar-input {
            padding: 0 0.75rem; /* px-3 */
            border-radius: 0.5rem; /* rounded-lg */
            color: #475569; /* slate-600 */
            border: 1px solid #e2e8f0; /* slate-200 */
            background-color: #f8fafc; /* slate-50 */
            height: 40px;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
        }
        .context-toolbar-separator {
            width: 1px;
            background-color: #e2e8f0; /* slate-200 */
            margin: 0 0.5rem; /* mx-2 */
            height: 24px;
            align-self: center;
        }

        /* [NEW] Canvas Footer (Zoom, Toggles) */
        .canvas-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.5rem; /* p-3 px-6 */
            background: #ffffff;
            border-top: 1px solid #e2e8f0;
            flex-shrink: 0;
            z-index: 10;
        }
        .view-tab.active {
            background-color: #e2e8f0; /* slate-200 */
            color: #1e293b; /* slate-800 */
        }

        /* [NEW] Right panel save button */
        .save-button {
            background-color: #10b981; /* green-500 */
            color: white;
            font-weight: bold;
            padding: 0.75rem;
            border-radius: 0.75rem;
            text-align: center;
            transition: all 0.2s;
            box-shadow: 0 10px 15px -12px rgba(16, 185, 129, 0.8);
        }
        .save-button:hover {
            background-color: #059669; /* green-600 */
            box-shadow: 0 12px 20px -10px rgba(5, 150, 105, 0.6);
        }

        /* [NEW] Styles for Font Picker */
        .font-upload-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0.75rem;
            border: 2px dashed #cbd5e1; /* slate-300 */
            border-radius: 0.75rem; /* rounded-xl */
            background-color: #ffffff;
            font-weight: 600;
            color: #3973b2; /* ci-blue */
            transition: all 0.2s;
        }
        .font-upload-button:hover {
            background-color: #f8fafc; /* slate-50 */
            border-color: #94a3b8; /* slate-400 */
        }
        .font-filter-button {
            padding: 0.375rem 1rem; /* py-1.5 px-4 */
            border-radius: 9999px; /* rounded-full */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            background-color: #ffffff;
            border: 1px solid #e2e8f0; /* slate-200 */
            color: #475569; /* slate-600 */
            transition: all 0.2s;
        }
        .font-filter-button:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .font-filter-button.active {
            background-color: #334155; /* slate-700 */
            color: #ffffff;
            border-color: #334155;
        }
        .font-list-item {
            padding: 0.625rem 0.75rem; /* py-2.5 px-3 */
            border-radius: 0.5rem; /* rounded-lg */
            cursor: pointer;
            font-size: 1.125rem; /* text-lg */
            transition: background-color 0.2s;
            color: #334155; /* slate-700 */
        }
        .font-list-item:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        /* Font preview simulations */
        .font-preview-display { font-family: "Times New Roman", Times, serif; font-weight: bold; }
        .font-preview-handwriting { font-family: "Cursive", "Comic Sans MS", sans-serif; }
        .font-preview-monospace { font-family: "Courier New", Courier, monospace; }

        /* [NEW] Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1; /* slate-300 */
            transition: .4s;
            border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #3973b2; /* ci-blue */
        }
        input:checked + .toggle-slider:before {
            transform: translateX(16px);
        }

        /* [NEW] Property Input Field */
        .property-input {
            width: 100%;
            padding: 0.5rem 0.75rem; /* px-3 py-2 */
            font-size: 0.875rem; /* text-sm */
            border: 1px solid #e2e8f0; /* slate-200 */
            border-radius: 0.5rem; /* rounded-lg */
            background-color: #f8fafc; /* slate-50 */
            outline: none;
            transition: box-shadow 0.2s ease, border-color 0.2s ease;
        }
        .property-input:focus {
            border-color: rgba(57, 115, 178, 0.4);
            box-shadow: 0 0 0 2px rgba(57, 115, 178, 0.25);
        }
        .property-input-group {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 0.75rem; /* gap-3 */
        }
        .property-label {
            display: block;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* medium */
            color: #334155; /* slate-700 */
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .property-section {
            padding-top: 1rem; /* pt-4 */
            margin-top: 1rem; /* mt-4 */
            border-top: 1px solid #f1f5f9; /* slate-100 */
        }
        .property-color-input {
            width: 2.5rem; /* w-10 */
            height: 2.5rem; /* h-10 */
            padding: 0;
            border: none;
            border-radius: 0.5rem; /* rounded-lg */
            cursor: pointer;
            overflow: hidden;
        }
        /* Hide color input default appearance */
        .property-color-input::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        .property-color-input::-webkit-color-swatch {
            border: 1px solid #e2e8f0; /* slate-200 */
            border-radius: 0.5rem;
        }

        /* [NEW] Accordion Styles for Properties Panel */
        .property-accordion {
            border-bottom: 1px solid #f1f5f9; /* slate-100 */
        }
        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 1rem 0.25rem; /* py-4 px-1 */
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* semibold */
            color: #1e293b; /* slate-800 */
            background-color: #ffffff;
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.2s;
        }
        .accordion-header:hover {
            background-color: #f8fafc; /* slate-50 */
        }
        .accordion-header span {
            display: flex;
            align-items: center;
        }
        .accordion-icon {
            transition: transform 0.3s ease;
            color: #94a3b8; /* slate-400 */
        }
        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            /* [NEW] Add padding bottom for spacing when open */
            padding-bottom: 0;
        }
        .accordion-content.open {
            /* A large enough value to allow content to show */
            max-height: 1500px; 
            padding-bottom: 1rem; /* pb-4 */
        }

        .insight-card {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 0.75rem;
            align-items: start;
            padding: 0.9rem 1rem;
            border-radius: 1rem;
            border: 1px solid #e2e8f0;
            background: #ffffff;
        }

        .insight-card strong {
            display: block;
            font-size: 0.85rem;
            color: #0f172a;
            margin-bottom: 0.2rem;
        }

        .insight-card span {
            font-size: 0.75rem;
            color: #64748b;
        }

        .right-panel-tab {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.45rem 0.95rem;
            border-radius: 9999px;
            border: 1px solid transparent;
            font-size: 0.75rem;
            font-weight: 600;
            color: #475569;
            background: transparent;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }

        .right-panel-tab.active {
            background: rgba(57, 115, 178, 0.12);
            border-color: rgba(57, 115, 178, 0.25);
            color: #0f172a;
        }

        .right-panel-section {
            display: none;
        }

        .right-panel-section.active {
            display: block;
        }


    </style>
</head>
<body class="text-slate-600 antialiased">

    <div class="editor-shell flex flex-col h-screen overflow-hidden">

        <!-- ================= Editor Header ================= -->
        <header class="editor-header bg-gradient-to-r from-ci-blue via-[#4f86c6] to-ci-yellow/90 text-white">
            <div class="px-6 lg:px-10 py-5 flex flex-col gap-5">
                <div class="flex flex-wrap items-start justify-between gap-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center text-2xl font-bold tracking-tight shadow-inner">
                            A
                        </div>
                        <div class="space-y-2">
                            <div class="flex flex-wrap items-center gap-3">
                                <p class="uppercase text-xs tracking-[0.35em] font-semibold text-white/70">Design project</p>
                                <span class="status-chip">
                                    <i data-lucide="activity" class="w-4 h-4"></i>
                                    Live sync enabled
                                </span>
                            </div>
                            <div>
                                <h1 class="text-xl font-semibold leading-6">Anajak Custom Tee</h1>
                                <p class="text-sm text-white/70">ออกแบบสินค้า POD ให้พร้อมขายและส่งตรงถึงลูกค้า</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="hidden sm:flex items-center gap-2 rounded-xl bg-white/15 px-4 py-2.5 text-sm font-semibold tracking-wide hover:bg-white/20 transition">
                            <i data-lucide="book-open-check" class="w-4 h-4"></i>
                            <span>คู่มือสั้น ๆ</span>
                        </button>
                        <button class="flex items-center gap-2 rounded-xl bg-white px-4 py-2.5 text-sm font-semibold text-ci-blue shadow-sm hover:shadow-md transition">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>Export mockup</span>
                        </button>
                        <button class="flex items-center gap-2 rounded-xl bg-black/20 px-4 py-2.5 text-sm font-semibold hover:bg-black/30 transition">
                            <i data-lucide="share-2" class="w-4 h-4"></i>
                            <span>แชร์ลิงก์</span>
                        </button>
                    </div>
                </div>

                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div id="header-meta" class="header-meta"></div>
                    <div class="min-w-[180px]">
                        <div class="header-progress-bar">
                            <span></span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ================= Editor Layout ================= -->
        <div class="flex-1 editor-layout overflow-hidden">

            <!-- 1. Far-Left Panel (Icon Navbar) -->
            <aside class="w-20 bg-white border-r border-slate-200 flex flex-col items-center flex-shrink-0">
                
                <!-- [NEW] Panel Header (Logo & Global Actions) -->
                <div class="h-[77px] flex-shrink-0 flex flex-col items-center justify-center gap-2 w-full border-b border-slate-200">
                    <!-- Logo (Example) -->
                    <div class="w-10 h-10 bg-ci-blue text-white flex items-center justify-center rounded-lg font-bold text-xl">
                        A
                    </div>
                    <!-- Global Actions -->
                    <div class="flex items-center gap-1">
                        <button class="p-1.5 rounded-md hover:bg-slate-100 text-slate-500 hover:text-slate-700">
                            <i data-lucide="undo-2" class="w-4 h-4"></i>
                        </button>
                        <button class="p-1.5 rounded-md hover:bg-slate-100 text-slate-500 hover:text-slate-700">
                            <i data-lucide="redo-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                
                <nav class="flex flex-col gap-1 p-2 mt-2 w-full">
                    <!-- [CHANGED] Re-ordered and set 'Product' as active -->
                    <button class="tool-nav-button active" data-tab="product">
                        <i data-lucide="shirt" class="w-6 h-6"></i>
                        <span class="text-xs mt-1">สินค้า</span>
                    </button>
                    <button class="tool-nav-button" data-tab="text">
                        <i data-lucide="type" class="w-6 h-6"></i>
                        <span class="text-xs mt-1">ข้อความ</span>
                    </button>
                    <button class="tool-nav-button" data-tab="upload">
                        <i data-lucide="upload-cloud" class="w-6 h-6"></i>
                        <span class="text-xs mt-1">อัปโหลด</span>
                    </button>
                    <button class="tool-nav-button" data-tab="templates">
                        <i data-lucide="layout-template" class="w-6 h-6"></i>
                        <span class="text-xs mt-1">เทมเพลต</span>
                    </button>
                    <button class="tool-nav-button" data-tab="elements">
                        <i data-lucide="shapes" class="w-6 h-6"></i>
                        <span class="text-xs mt-1">องค์ประกอบ</span>
                    </button>
                    <button class="tool-nav-button" data-tab="ai">
                        <i data-lucide="sparkles" class="w-6 h-6"></i>
                        <span class="text-xs mt-1">Ai</span>
                    </button>
                    <!-- [NEW] Layers tab -->
                    <button class="tool-nav-button" data-tab="layers">
                        <i data-lucide="layers" class="w-6 h-6"></i>
                        <span class="text-xs mt-1">เลเยอร์</span>
                    </button>
                </nav>
            </aside>

            <!-- 2. Left Panel (Tools Content) -->
            <aside class="w-80 bg-light border-r border-slate-200 flex flex-col overflow-hidden">
                <!-- Tool Content -->
                <div class="flex-1 overflow-y-auto p-6 space-y-6">
                    
                    <!-- [NEW] Panel 1: Product (Moved from right panel) -->
                    <div id="panel-product" class="tool-panel active space-y-6">
                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
                            <div class="flex items-start justify-between gap-3">
                                <div>
                                    <h3 class="panel-title">Unisex Premium Tee</h3>
                                    <p class="panel-subtitle">Cotton 100% · พิมพ์ DTG · จัดส่งภายใน 48 ชม.</p>
                                </div>
                                <button class="text-xs font-semibold text-ci-blue hover:underline">ดูข้อมูลสินค้า</button>
                            </div>
                            <div class="mt-4 grid grid-cols-2 gap-3 text-xs text-slate-600">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="ruler" class="w-4 h-4 text-ci-blue"></i>
                                    พื้นที่พิมพ์ 32 x 45 cm
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="globe-2" class="w-4 h-4 text-ci-blue"></i>
                                    Fulfillment: Bangkok HUB
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="leaf" class="w-4 h-4 text-ci-blue"></i>
                                    หมึก Eco-Friendly
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="badge-check" class="w-4 h-4 text-ci-blue"></i>
                                    QC ก่อนจัดส่งทุกชิ้น
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h4 class="panel-title">สีเสื้อ (Colors)</h4>
                                <button class="text-xs font-semibold text-ci-blue hover:underline">จัดการคอลเลกชัน</button>
                            </div>
                            <div id="color-options" class="grid grid-cols-6 gap-3"></div>
                        </div>

                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h4 class="panel-title">ขนาด (Sizes)</h4>
                                <span class="text-xs text-slate-400">มีสินค้า: XS - 3XL</span>
                            </div>
                            <div id="size-options" class="grid grid-cols-5 gap-2"></div>
                            <div class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-xs text-slate-600">
                                <div class="flex items-center gap-2 font-semibold text-slate-700"><i data-lucide="list-checks" class="w-4 h-4 text-ci-blue"></i> คำแนะนำ:</div>
                                <p class="mt-2 leading-relaxed">เปิดใช้งาน 2-3 ขนาดหลักที่ขายดีที่สุด และเพิ่มไซส์พิเศษเมื่อมีคำสั่งซื้อ</p>
                            </div>
                        </div>

                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-3">
                            <h4 class="panel-title">รายละเอียดการผลิต</h4>
                            <ul class="space-y-2 text-xs text-slate-600">
                                <li class="flex items-start gap-2">
                                    <i data-lucide="shield-check" class="w-4 h-4 mt-0.5 text-ci-blue"></i>
                                    รับประกันคุณภาพงานพิมพ์ภายใน 30 วัน
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="truck" class="w-4 h-4 mt-0.5 text-ci-blue"></i>
                                    ส่งด่วนภายในประเทศ 1-3 วันทำการ
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="info" class="w-4 h-4 mt-0.5 text-ci-blue"></i>
                                    แนะนำอัปโหลดไฟล์ PNG/SVG ความละเอียด 300 DPI
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Panel 2: Upload -->
                    <div id="panel-upload" class="tool-panel space-y-6">
                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-4">
                            <div>
                                <label class="panel-title">อัปโหลดไฟล์ของคุณ</label>
                                <p class="panel-subtitle mt-1">รองรับ PNG, JPG, SVG และ PSD (สูงสุด 15MB)</p>
                            </div>
                            <label class="flex flex-col items-center justify-center w-full h-44 border-2 border-dashed border-slate-300 rounded-2xl cursor-pointer bg-slate-50 hover:border-ci-blue hover:bg-white transition-all">
                                <i data-lucide="upload-cloud" class="w-10 h-10 mb-2 text-ci-blue"></i>
                                <span class="font-semibold text-ci-blue">ลากไฟล์มาวางหรือคลิกเพื่อเลือก</span>
                                <span class="text-xs text-slate-500">แนะนำไฟล์พื้นหลังโปร่ง (Transparent)</span>
                                <input type="file" class="hidden">
                            </label>
                            <div class="grid grid-cols-2 gap-3 text-xs text-slate-600">
                                <div class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 flex items-center gap-2">
                                    <i data-lucide="clock" class="w-4 h-4 text-ci-blue"></i>
                                    อัปโหลดล่าสุด<br><span class="font-semibold text-slate-700">8 นาทีที่แล้ว</span>
                                </div>
                                <div class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 flex items-center gap-2">
                                    <i data-lucide="shield-check" class="w-4 h-4 text-ci-blue"></i>
                                    ตรวจลิขสิทธิ์อัตโนมัติ
                                </div>
                            </div>
                        </div>
                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-4">
                            <div class="flex items-center justify-between">
                                <h4 class="panel-title">ไลบรารีของฉัน</h4>
                                <button class="text-xs font-semibold text-ci-blue hover:underline">จัดการโฟลเดอร์</button>
                            </div>
                            <div class="grid grid-cols-3 gap-3">
                                <div class="relative aspect-square rounded-xl border border-slate-200 bg-slate-50 p-2 cursor-pointer hover:border-ci-blue transition">
                                    <img src="https://placehold.co/100x100/e2e8f0/334155?text=Logo" class="w-full h-full object-contain rounded-md">
                                    <span class="absolute bottom-1 left-2 rounded-full bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-600">โลโก้</span>
                                </div>
                                <div class="relative aspect-square rounded-xl border border-slate-200 bg-slate-50 p-2 cursor-pointer hover:border-ci-blue transition">
                                    <img src="https://placehold.co/100x100/fec91b/0f172a?text=Badge" class="w-full h-full object-contain rounded-md">
                                    <span class="absolute bottom-1 left-2 rounded-full bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-600">Badge</span>
                                </div>
                                <div class="relative aspect-square rounded-xl border border-dashed border-ci-blue bg-white p-2 cursor-pointer hover:bg-ci-blue/5 transition flex items-center justify-center text-xs font-semibold text-ci-blue">
                                    + เพิ่มใหม่
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- [CHANGED] Panel 3: Text (No longer default active) -->
                    <div id="panel-text" class="tool-panel space-y-6">
                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-4">
                            <button class="w-full px-5 py-3 text-sm font-bold text-white rounded-xl shadow-lg shadow-ci-blue/20 hover:shadow-ci-blue/40 transition-all" style="background: linear-gradient(135deg, #3973b2, #4f86c6);">
                                <i data-lucide="plus" class="w-4 h-4 mr-2 inline-block"></i> เพิ่มข้อความใหม่
                            </button>
                            <div class="grid grid-cols-2 gap-3 text-xs text-slate-600">
                                <button class="flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 hover:border-ci-blue hover:text-ci-blue transition">
                                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                                    Magic headline
                                </button>
                                <button class="flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 hover:border-ci-blue hover:text-ci-blue transition">
                                    <i data-lucide="type" class="w-4 h-4"></i>
                                    แท็กไลน์ 1 บรรทัด
                                </button>
                                <button class="flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 hover:border-ci-blue hover:text-ci-blue transition">
                                    <i data-lucide="scan-text" class="w-4 h-4"></i>
                                    Quote โดนใจ
                                </button>
                                <button class="flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 hover:border-ci-blue hover:text-ci-blue transition">
                                    <i data-lucide="languages" class="w-4 h-4"></i>
                                    Template อังกฤษ/ไทย
                                </button>
                            </div>
                        </div>

                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-4">
                            <div class="flex items-center justify-between">
                                <h4 class="panel-title">ข้อความโค้ง (Curved Text)</h4>
                                <button class="text-xs font-semibold text-ci-blue hover:underline">ตั้งค่าขั้นสูง</button>
                            </div>
                            <div class="grid grid-cols-3 gap-2">
                                <button class="flex flex-col items-center justify-center p-3 h-24 bg-slate-50 border border-slate-200 rounded-xl hover:border-ci-blue hover:bg-white transition">
                                    <i data-lucide="arrow-down-to-line" class="w-5 h-5 text-slate-500 transform -rotate-45 scale-x-[-1]"></i>
                                    <span class="mt-2 text-xs font-medium">Arch Down</span>
                                </button>
                                <button class="flex flex-col items-center justify-center p-3 h-24 bg-slate-50 border border-slate-200 rounded-xl hover:border-ci-blue hover:bg-white transition">
                                    <i data-lucide="arrow-up-to-line" class="w-5 h-5 text-slate-500 transform -rotate-45"></i>
                                    <span class="mt-2 text-xs font-medium">Arch Up</span>
                                </button>
                                <button class="flex flex-col items-center justify-center p-3 h-24 bg-slate-50 border border-slate-200 rounded-xl hover:border-ci-blue hover:bg-white transition">
                                    <i data-lucide="circle" class="w-5 h-5 text-slate-500"></i>
                                    <span class="mt-2 text-xs font-medium">Circle</span>
                                </button>
                            </div>
                        </div>

                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-800 mb-2">ค้นหาฟอนต์</label>
                                <div class="relative">
                                    <i data-lucide="search" class="w-4 h-4 text-slate-400 absolute left-3.5 top-1/2 -translate-y-1/2"></i>
                                    <input type="text" placeholder="ค้นหาชื่อฟอนต์หรือสไตล์" class="w-full pl-10 pr-4 py-2.5 text-sm border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-ci-blue/50 bg-white">
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-2 text-xs">
                                <button class="font-filter-button active">Display</button>
                                <button class="font-filter-button">Handwriting</button>
                                <button class="font-filter-button">Monospace</button>
                                <button class="font-filter-button">Serif</button>
                                <button class="font-filter-button">Sans</button>
                                <button class="font-filter-button">Thai Ready</button>
                            </div>
                            <div class="pt-2 border-t border-slate-100">
                                <div class="flex justify-between items-center mb-3">
                                    <label class="text-sm font-bold text-slate-800">My fonts</label>
                                    <span class="text-xs font-medium text-white bg-ci-blue px-2 py-0.5 rounded-full">NEW</span>
                                </div>
                                <button class="font-upload-button">
                                    <i data-lucide="upload-cloud" class="w-4 h-4 mr-2"></i>
                                    Upload font
                                </button>
                            </div>
                            <div class="border-t border-slate-100 pt-4">
                                <label class="block text-sm font-bold text-slate-800 mb-3">Discover fonts</label>
                                <div class="space-y-1 h-80 overflow-y-auto pr-2 border-b border-slate-200">
                                    <div class="font-list-item">ABeeZee</div>
                                    <div class="font-list-item">Abel</div>
                                    <div class="font-list-item">Abhaya Libre</div>
                                    <div class="font-list-item font-preview-display">Abril Fatface</div>
                                    <div class="font-list-item">Acme</div>
                                    <div class="font-list-item">Actor</div>
                                    <div class="font-list-item">Adamina</div>
                                    <div class="font-list-item font-preview-handwriting">Dancing Script</div>
                                    <div class="font-list-item font-preview-monospace">Roboto Mono</div>
                                    <div class="font-list-item">Sarabun</div>
                                    <div class="font-list-item">Inter</div>
                                    <div class="font-list-item font-preview-display">Prompt</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Panel 4: Elements -->
                    <div id="panel-elements" class="tool-panel space-y-6">
                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="panel-title flex items-center gap-2">
                                    <i data-lucide="shapes" class="w-5 h-5 text-ci-blue"></i>
                                    องค์ประกอบ (Elements)
                                </h3>
                                <button class="text-xs font-semibold text-ci-blue hover:underline">ดูทั้งหมด</button>
                            </div>
                            <div class="grid grid-cols-3 gap-3">
                                <button class="aspect-square rounded-xl border border-slate-200 bg-slate-50 flex flex-col items-center justify-center gap-2 text-xs font-semibold text-slate-600 hover:border-ci-blue hover:bg-white transition">
                                    <i data-lucide="triangle" class="w-5 h-5"></i>
                                    Basic
                                </button>
                                <button class="aspect-square rounded-xl border border-slate-200 bg-slate-50 flex flex-col items-center justify-center gap-2 text-xs font-semibold text-slate-600 hover:border-ci-blue hover:bg-white transition">
                                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                                    Sticker
                                </button>
                                <button class="aspect-square rounded-xl border border-slate-200 bg-slate-50 flex flex-col items-center justify-center gap-2 text-xs font-semibold text-slate-600 hover:border-ci-blue hover:bg-white transition">
                                    <i data-lucide="badge-check" class="w-5 h-5"></i>
                                    Badges
                                </button>
                            </div>
                            <div class="pt-3 border-t border-slate-100">
                                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Trending</p>
                                <div class="mt-3 grid grid-cols-2 gap-3">
                                    <div class="relative aspect-[5/4] rounded-xl border border-slate-200 bg-gradient-to-br from-slate-100 to-white p-3 cursor-pointer hover:border-ci-blue transition">
                                        <span class="absolute top-2 right-2 rounded-full bg-white px-2 py-1 text-[10px] font-semibold text-ci-blue">NEW</span>
                                        <div class="h-full w-full rounded-lg border-2 border-dashed border-slate-300"></div>
                                        <p class="mt-2 text-xs font-semibold text-slate-600">Minimal frame</p>
                                    </div>
                                    <div class="relative aspect-[5/4] rounded-xl border border-slate-200 bg-gradient-to-br from-slate-100 to-white p-3 cursor-pointer hover:border-ci-blue transition">
                                        <div class="h-full w-full rounded-lg bg-gradient-to-br from-amber-200 via-orange-200 to-rose-200"></div>
                                        <p class="mt-2 text-xs font-semibold text-slate-600">Sunset wave</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Panel 5: Templates -->
                    <div id="panel-templates" class="tool-panel space-y-6">
                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="panel-title flex items-center gap-2">
                                    <i data-lucide="layout-template" class="w-5 h-5 text-ci-blue"></i>
                                    เทมเพลต (Templates)
                                </h3>
                                <button class="text-xs font-semibold text-ci-blue hover:underline">เปิด Marketplace</button>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="relative overflow-hidden rounded-xl border border-slate-200 bg-slate-50 cursor-pointer hover:border-ci-blue transition">
                                    <img src="https://placehold.co/240x300/0f172a/ffffff?text=Streetwear" class="w-full h-full object-cover">
                                    <span class="absolute bottom-2 left-2 rounded-full bg-white/90 px-2 py-1 text-[10px] font-semibold text-slate-700">Streetwear Drop</span>
                                </div>
                                <div class="relative overflow-hidden rounded-xl border border-slate-200 bg-slate-50 cursor-pointer hover:border-ci-blue transition">
                                    <img src="https://placehold.co/240x300/1e293b/fec91b?text=Minimal" class="w-full h-full object-cover">
                                    <span class="absolute bottom-2 left-2 rounded-full bg-white/90 px-2 py-1 text-[10px] font-semibold text-slate-700">Minimalist Badge</span>
                                </div>
                                <div class="relative overflow-hidden rounded-xl border border-slate-200 bg-slate-50 cursor-pointer hover:border-ci-blue transition">
                                    <img src="https://placehold.co/240x300/334155/f8fafc?text=Typography" class="w-full h-full object-cover">
                                    <span class="absolute bottom-2 left-2 rounded-full bg-white/90 px-2 py-1 text-[10px] font-semibold text-slate-700">Typography Pair</span>
                                </div>
                                <div class="relative overflow-hidden rounded-xl border border-slate-200 bg-slate-50 cursor-pointer hover:border-ci-blue transition">
                                    <img src="https://placehold.co/240x300/475569/fec91b?text=Sport" class="w-full h-full object-cover">
                                    <span class="absolute bottom-2 left-2 rounded-full bg-white/90 px-2 py-1 text-[10px] font-semibold text-slate-700">Sport Club</span>
                                </div>
                            </div>
                            <div class="rounded-xl border border-slate-100 bg-slate-50 px-4 py-3 text-xs text-slate-600">
                                เปลี่ยนเทมเพลตจะไม่ลบเลเยอร์เดิม ระบบจะสร้างสำเนาไว้ให้เพื่อย้อนกลับได้ทุกเมื่อ
                            </div>
                        </div>
                    </div>
                    
                    <!-- [REMOVED] Panel 6: Layers (This was a duplicate, it's in the right panel) -->

                    <!-- Panel 7: AI -->
                    <div id="panel-ai" class="tool-panel space-y-6">
                        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="panel-title flex items-center gap-2">
                                    <i data-lucide="sparkles" class="w-5 h-5 text-ci-blue"></i>
                                    Ai Magic
                                </h3>
                                <span class="rounded-full bg-slate-100 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.3em] text-slate-500">Beta</span>
                            </div>
                            <textarea rows="3" class="w-full px-4 py-2 text-sm border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-ci-blue/50 bg-white" placeholder="เช่น 'Streetwear neon tiger' หรือ 'ลายเส้นมินิมอลไทย'"></textarea>
                            <div class="flex items-center gap-2 text-xs text-slate-500">
                                <i data-lucide="info" class="w-4 h-4 text-ci-blue"></i>
                                Ai จะสร้างลายพื้นหลังแบบโปร่งเพื่อใช้งานกับพื้นที่พิมพ์ DTG
                            </div>
                            <button class="w-full px-5 py-3 text-sm font-bold text-white rounded-xl shadow-lg shadow-ci-blue/20 hover:shadow-ci-blue/40 transition-all" style="background: linear-gradient(135deg, #3973b2, #4f86c6);">
                                <i data-lucide="zap" class="w-4 h-4 mr-2 inline-block"></i> สร้างภาพ
                            </button>
                            <div class="pt-4 border-t border-slate-100">
                                <p class="text-xs font-semibold uppercase tracking-[0.25em] text-slate-400">Prompt แนะนำ</p>
                                <div class="mt-3 grid grid-cols-2 gap-2 text-xs text-slate-600">
                                    <button class="rounded-xl border border-slate-200 px-3 py-2 text-left hover:border-ci-blue hover:text-ci-blue transition">Retro arcade typography</button>
                                    <button class="rounded-xl border border-slate-200 px-3 py-2 text-left hover:border-ci-blue hover:text-ci-blue transition">Floral line art overlay</button>
                                    <button class="rounded-xl border border-slate-200 px-3 py-2 text-left hover:border-ci-blue hover:text-ci-blue transition">Cartoon mascot minimal</button>
                                    <button class="rounded-xl border border-slate-200 px-3 py-2 text-left hover:border-ci-blue hover:text-ci-blue transition">Gradient vaporwave streak</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- [NEW] Panel 8: Layers (Moved from right panel) -->
                    <div id="panel-layers" class="tool-panel space-y-6">
                        <div>
                            <h3 class="text-base font-bold text-slate-800 mb-4 flex items-center">
                                <i data-lucide="layers" class="w-5 h-5 mr-2 text-slate-400"></i>
                                เลเยอร์ (Layers)
                            </h3>
                            <div class="space-y-2">
                                <!-- Layer Item (Selected) -->
                                <div id="layer-item-1" class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-200 cursor-pointer">
                                    <div class="flex items-center gap-2 overflow-hidden">
                                        <i data-lucide="type" class="w-4 h-4 text-slate-500 flex-shrink-0"></i>
                                        <span class="text-sm font-medium text-slate-700 truncate">NEW DAY</span>
                                    </div>
                                    <i data-lucide="eye" class="w-4 h-4 text-slate-500 hover:text-slate-800 flex-shrink-0"></i>
                                </div>
                                <!-- Layer Item -->
                                <div id="layer-item-2" class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-100">
                                    <div class="flex items-center gap-2 overflow-hidden">
                                        <i data-lucide="image" class="w-4 h-4 text-slate-500 flex-shrink-0"></i>
                                        <span class="text-sm font-medium text-slate-700 truncate">Your-Design.png</span>
                                    </div>
                                    <i data-lucide="eye-off" class="w-4 h-4 text-slate-400 hover:text-slate-800 flex-shrink-0"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 3. Center Panel (Canvas) -->
            <!-- [CHANGED] Using new canvas-layout grid -->
            <main class="flex-1 flex flex-col overflow-hidden bg-slate-100 relative canvas-layout">
                
                <!-- [NEW] Canvas Welcome Bar -->
                <div id="canvas-welcome-bar" class="flex flex-wrap items-center justify-between gap-4 px-6 py-4 bg-white border-b border-slate-200">
                    <div class="flex items-center gap-3">
                        <span class="flex h-10 w-10 items-center justify-center rounded-xl bg-ci-blue/10 text-ci-blue">
                            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        </span>
                        <div>
                            <p class="text-xs font-semibold uppercase tracking-[0.4em] text-slate-400">แคนวาสหลัก</p>
                            <p class="text-sm font-semibold text-slate-800">ลากองค์ประกอบเพื่อเติมเต็มพื้นที่ให้ลงตัว</p>
                        </div>
                    </div>
                    <div class="flex flex-wrap items-center gap-2">
                        <button class="flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:border-ci-blue hover:text-ci-blue transition">
                            <i data-lucide="lightbulb" class="w-4 h-4"></i>
                            <span>ดูคำแนะนำฉับไว</span>
                        </button>
                        <button class="flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:border-ci-blue hover:text-ci-blue transition">
                            <i data-lucide="ruler" class="w-4 h-4"></i>
                            <span>เปิดเส้นไกด์</span>
                        </button>
                        <button class="flex items-center gap-2 rounded-xl bg-ci-blue px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-ci-dark transition">
                            <i data-lucide="sparkles" class="w-4 h-4"></i>
                            <span>ให้ Ai แนะนำ</span>
                        </button>
                    </div>
                </div>

                <!-- [NEW] Fixed Context Toolbar (replaces old floating one) -->
                <div id="context-toolbar-main" class="context-toolbar hidden">
                    <!-- [REMOVED] Position dropdown, it's in the right panel -->
                    <select class="context-toolbar-dropdown w-48">
                        <option>Rubik Spray Paint</option>
                        <option>Inter</option>
                        <option>Sarabun</option>
                    </select>
                    <input type="number" value="90" class="context-toolbar-input w-20 text-center">
                    
                    <!-- [NEW] Color Picker -->
                    <input type="color" value="#334155" class="w-10 h-10 p-1 bg-white border border-slate-200 rounded-lg cursor-pointer">

                    <div class="context-toolbar-separator"></div>
                    <button class="context-toolbar-button"><i data-lucide="bold" class="w-5 h-5"></i></button>
                    <button class="context-toolbar-button"><i data-lucide="italic" class="w-5 h-5"></i></button>
                    <!-- [NEW] Underline Button -->
                    <button class="context-toolbar-button"><i data-lucide="underline" class="w-5 h-5"></i></button>
                    <div class="context-toolbar-separator"></div>
                    <button class="context-toolbar-button"><i data-lucide="align-left" class="w-5 h-5"></i></button>
                    <!-- [NEW] Align Buttons -->
                    <button class="context-toolbar-button active-state"><i data-lucide="align-center" class="w-5 h-5"></i></button>
                    <button class="context-toolbar-button"><i data-lucide="align-right" class="w-5 h-5"></i></button>
                    <div class="context-toolbar-separator"></div>
                    <button class="context-toolbar-button" title="Effects">
                        <i data-lucide="wand-2" class="w-5 h-5"></i>
                    </button> 
                    <button class="context-toolbar-button" title="Copy"><i data-lucide="copy" class="w-5 h-5"></i></button>
                    <button class="context-toolbar-button text-rose-500 hover:bg-rose-50" title="Delete"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                    <div class="context-toolbar-separator"></div>
                    <button class="context-toolbar-dropdown text-sm ml-auto">Apply to all areas</button>
                    <!-- [REMOVED] Save as template button -->
                </div>

                <!-- Mockup Area (The canvas itself) -->
                <div class="flex-1 overflow-auto px-6 pb-6">
                    <div class="canvas-stage">
                        <div class="stage-inner">
                            <div class="relative w-full max-w-lg aspect-[4/5] flex-shrink-0">
                                <span class="annotation-badge flex items-center gap-2">
                                    <i data-lucide="scan" class="w-4 h-4"></i>
                                    พื้นที่พิมพ์ปลอดภัย 80%
                                </span>
                                <div class="absolute inset-6 border-2 border-dashed border-white/30 rounded-xl pointer-events-none"></div>
                                <!-- T-Shirt Image -->
                                <img id="mockup-image" src="https://placehold.co/800x1000/ffffff/f1f5f9?text=+" class="w-full h-full object-contain drop-shadow-xl" alt="T-Shirt Mockup Front">
                                
                                <!-- Print Area -->
                                <div id="print-area">
                                    <!-- Draggable Element (Demo) -->
                                    <div id="design-element">
                                        <span>NEW DAY</span>
                                        <!-- [NEW] Resize Handles -->
                                        <div class="resize-handle top-left"></div>
                                        <div class="resize-handle top-right"></div>
                                        <div class="resize-handle bottom-left"></div>
                                        <div class="resize-handle bottom-right"></div>
                                    </div>
                                </div>

                                <!-- Measurement Guides -->
                                <div class="absolute -left-16 top-1/2 -translate-y-1/2 flex flex-col items-center text-[11px] font-semibold text-slate-400">
                                    <span>45 cm</span>
                                    <span class="mt-2 h-40 border-l border-dashed border-slate-300"></span>
                                </div>
                                <div class="absolute top-full left-1/2 -translate-x-1/2 mt-3 flex items-center gap-2 text-[11px] font-semibold text-slate-400">
                                    <span class="w-40 border-t border-dashed border-slate-300"></span>
                                    <span>32 cm</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- [NEW] Canvas Footer (Zoom & View Toggles) -->
                <div class="canvas-footer">
                    <!-- Left: Zoom & Tools -->
                    <div class="flex items-center gap-3">
                        <button class="p-2 rounded-lg hover:bg-slate-100"><i data-lucide="minus" class="w-5 h-5 text-slate-500"></i></button>
                        <span class="text-sm font-bold text-slate-700 w-12 text-center">100%</span>
                        <button class="p-2 rounded-lg hover:bg-slate-100"><i data-lucide="plus" class="w-5 h-5 text-slate-500"></i></button>
                        <div class="context-toolbar-separator"></div>
                        <button class="p-2 rounded-lg hover:bg-slate-100"><i data-lucide="ruler" class="w-5 h-5 text-slate-500"></i></button>
                        <button class="p-2 rounded-lg hover:bg-slate-100"><i data-lucide="grid" class="w-5 h-5 text-slate-500"></i></button>
                    </div>
                    
                    <!-- Center: View Toggles [MOVED] -->
                    <div class="flex-shrink-0 bg-slate-100 p-1 rounded-lg flex gap-1 z-10">
                        <button class="view-tab active px-5 py-1.5 rounded-md text-sm font-bold" data-view="front">
                            Front side
                        </button>
                        <button class="view-tab px-5 py-1.5 rounded-md text-sm font-medium text-slate-500" data-view="back">
                            Back side
                        </button>
                    </div>

                    <!-- Right: Spacer -->
                    <div class="w-48"></div> <!-- Spacer to balance footer -->
                </div>
            </main>

            <!-- 4. Right Panel (Properties & Layers) -->
            <!-- [CHANGED] Added header/footer to this panel -->
            <aside class="w-80 bg-white border-l border-slate-200 flex flex-col overflow-hidden">
                
                <!-- [NEW] Right Panel Header -->
                <div class="flex items-center justify-end gap-3 p-4 border-b border-slate-200 flex-shrink-0 h-[77px]"> <!-- Match height of context bar -->
                    <button class="flex items-center px-4 py-2.5 text-sm font-bold text-slate-800 bg-slate-100 rounded-xl hover:bg-slate-200 transition-all">
                        Edit
                    </button>
                    <button class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-all">
                        <i data-lucide="eye" class="w-4 h-4 mr-2"></i> Preview
                    </button>
                </div>
                
                <!-- Scrollable Content -->
                <div class="flex-1 overflow-y-auto p-6 space-y-6">
                    
                    <!-- [REMOVED] Section: Variants (Moved to left panel) -->

                    <!-- [REMOVED] Separator -->

                    <!-- [CHANGED] Section: Layers (Only properties remain) -->
                    <div class="space-y-4">
                        <div class="flex items-center gap-2 rounded-xl border border-slate-200 bg-slate-50 p-1">
                            <button class="right-panel-tab active" data-right-panel="overview">
                                <i data-lucide="layout-dashboard" class="w-4 h-4"></i>
                                Overview
                            </button>
                            <button class="right-panel-tab" data-right-panel="insights">
                                <i data-lucide="activity" class="w-4 h-4"></i>
                                Insights
                            </button>
                            <button class="right-panel-tab" data-right-panel="properties">
                                <i data-lucide="sliders-horizontal" class="w-4 h-4"></i>
                                Properties
                            </button>
                        </div>

                        <div id="right-panel-overview" class="right-panel-section active space-y-4">
                            <div class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-ci-blue to-ci-dark text-white p-5 shadow-sm">
                                <div class="absolute -right-12 -top-12 h-32 w-32 rounded-full bg-white/10"></div>
                                <div class="absolute -left-10 bottom-0 h-24 w-24 rounded-full bg-white/5"></div>
                                <div class="relative flex items-start justify-between gap-4">
                                    <div>
                                        <p class="uppercase text-[11px] tracking-[0.4em] text-white/70">สถานะโปรเจกต์</p>
                                        <h2 class="text-lg font-semibold leading-tight">พร้อมเผยแพร่ใน 3 ขั้นตอน</h2>
                                    </div>
                                    <button class="flex items-center gap-2 rounded-xl bg-white/20 px-3 py-2 text-xs font-semibold uppercase tracking-wide hover:bg-white/30 transition">
                                        <i data-lucide="check-circle-2" class="w-4 h-4"></i>
                                        <span>ตรวจสอบรายการ</span>
                                    </button>
                                </div>
                                <div class="mt-4 grid grid-cols-3 gap-3 text-xs font-medium">
                                    <div class="rounded-xl bg-white/15 px-3 py-3">
                                        <p class="flex items-center gap-2 text-white/70">
                                            <i data-lucide="layers" class="w-4 h-4"></i>
                                            เลเยอร์ทั้งหมด
                                        </p>
                                        <p class="mt-2 text-base font-semibold">4 รายการ</p>
                                    </div>
                                    <div class="rounded-xl bg-white/15 px-3 py-3">
                                        <p class="flex items-center gap-2 text-white/70">
                                            <i data-lucide="sparkles" class="w-4 h-4"></i>
                                            แนะนำเพิ่มเติม
                                        </p>
                                        <p class="mt-2 text-base font-semibold">2 Action</p>
                                    </div>
                                    <div class="rounded-xl bg-white/15 px-3 py-3">
                                        <p class="flex items-center gap-2 text-white/70">
                                            <i data-lucide="target" class="w-4 h-4"></i>
                                            พื้นที่พิมพ์
                                        </p>
                                        <p class="mt-2 text-base font-semibold">ปลอดภัย 98%</p>
                                    </div>
                                </div>
                            </div>

                            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-5 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-sm font-bold text-slate-800 flex items-center gap-2">
                                        <i data-lucide="lightbulb" class="w-4 h-4 text-ci-blue"></i>
                                        ไอเดียเพิ่มความสวยงาม
                                    </h3>
                                    <button class="text-xs font-semibold text-ci-blue hover:underline">ดูทั้งหมด</button>
                                </div>
                                <ul class="mt-4 space-y-3 text-sm text-slate-600">
                                    <li class="flex items-start gap-3">
                                        <span class="mt-0.5 flex h-7 w-7 items-center justify-center rounded-lg bg-white border border-slate-200">
                                            <i data-lucide="type" class="w-4 h-4 text-ci-blue"></i>
                                        </span>
                                        <span>เพิ่มชื่อร้านหรือข้อความสั้น ๆ ที่ด้านหลังเพื่อเพิ่มเอกลักษณ์</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="mt-0.5 flex h-7 w-7 items-center justify-center rounded-lg bg-white border border-slate-200">
                                            <i data-lucide="grid" class="w-4 h-4 text-ci-blue"></i>
                                        </span>
                                        <span>ใช้เส้นตารางเพื่อจัดองค์ประกอบให้สมมาตร</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="mt-0.5 flex h-7 w-7 items-center justify-center rounded-lg bg-white border border-slate-200">
                                            <i data-lucide="image" class="w-4 h-4 text-ci-blue"></i>
                                        </span>
                                        <span>ลองอัปโหลดลายเสริมด้านข้างเพื่อเติมเต็มพื้นที่ด้านขวา</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div id="right-panel-insights" class="right-panel-section space-y-3">
                            <div class="insight-card">
                                <span class="flex h-10 w-10 items-center justify-center rounded-full bg-ci-blue/10 text-ci-blue">
                                    <i data-lucide="shopping-bag" class="w-4 h-4"></i>
                                </span>
                                <div>
                                    <strong>ยอดคำสั่งซื้อสินค้าแนว Streetwear</strong>
                                    <span>ช่วง 30 วันที่ผ่านมาเติบโต +18% ลองเพิ่มลายใหม่เพื่อใช้กระแส</span>
                                </div>
                            </div>
                            <div class="insight-card">
                                <span class="flex h-10 w-10 items-center justify-center rounded-full bg-amber-100 text-amber-500">
                                    <i data-lucide="sun" class="w-4 h-4"></i>
                                </span>
                                <div>
                                    <strong>สีเหลืองขายดีในเดือนนี้</strong>
                                    <span>ลูกค้าตอบรับดีมากกับโทน Sunshine · ปรับสีฟอนต์หรือองค์ประกอบให้เข้ากัน</span>
                                </div>
                            </div>
                            <div class="insight-card">
                                <span class="flex h-10 w-10 items-center justify-center rounded-full bg-emerald-100 text-emerald-600">
                                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                                </span>
                                <div>
                                    <strong>แนะนำใช้ Ai เติมไอเดีย</strong>
                                    <span>ให้ระบบช่วยสร้างลายกราฟิกพื้นหลัง แล้วปรับความทึบเพื่อลดความโล่ง</span>
                                </div>
                            </div>
                        </div>

                        <div id="right-panel-properties" class="right-panel-section space-y-4">
                            <div id="layer-properties" class="space-y-4">
                                <p class="text-sm text-slate-400 text-center py-4">เลือกเลเยอร์เพื่อแก้ไขคุณสมบัติ</p>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- [NEW] Right Panel Footer (Save Button) -->
                <div class="p-4 border-t border-slate-200 flex-shrink-0">
                    <button class="save-button w-full">
                        Save product
                    </button>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // ========================================
        // 🎯 HISTORY & UNDO/REDO SYSTEM
        // ========================================
        class HistoryManager {
            constructor() {
                this.history = [];
                this.currentIndex = -1;
                this.maxHistory = 50;
            }

            push(state) {
                // Remove any history after current index
                this.history = this.history.slice(0, this.currentIndex + 1);
                
                // Add new state
                this.history.push(JSON.parse(JSON.stringify(state)));
                this.currentIndex++;
                
                // Limit history size
                if (this.history.length > this.maxHistory) {
                    this.history.shift();
                    this.currentIndex--;
                }
                
                this.updateButtons();
            }

            undo() {
                if (this.canUndo()) {
                    this.currentIndex--;
                    this.updateButtons();
                    return this.history[this.currentIndex];
                }
                return null;
            }

            redo() {
                if (this.canRedo()) {
                    this.currentIndex++;
                    this.updateButtons();
                    return this.history[this.currentIndex];
                }
                return null;
            }

            canUndo() {
                return this.currentIndex > 0;
            }

            canRedo() {
                return this.currentIndex < this.history.length - 1;
            }

            updateButtons() {
                const undoBtn = document.querySelector('[data-action="undo"]');
                const redoBtn = document.querySelector('[data-action="redo"]');
                
                if (undoBtn) {
                    undoBtn.disabled = !this.canUndo();
                    undoBtn.style.opacity = this.canUndo() ? '1' : '0.5';
                }
                if (redoBtn) {
                    redoBtn.disabled = !this.canRedo();
                    redoBtn.style.opacity = this.canRedo() ? '1' : '0.5';
                }
            }
        }

        const historyManager = new HistoryManager();

        // ========================================
        // 💾 AUTO-SAVE SYSTEM
        // ========================================
        class AutoSaveManager {
            constructor() {
                this.interval = 30000; // 30 seconds
                this.timer = null;
                this.lastSaved = Date.now();
            }

            start() {
                this.timer = setInterval(() => {
                    this.save();
                }, this.interval);
            }

            save() {
                const state = this.getCurrentState();
                localStorage.setItem('anajak_autosave', JSON.stringify(state));
                this.lastSaved = Date.now();
                this.showNotification('บันทึกอัตโนมัติแล้ว');
                this.updateLastSavedTime();
            }

            getCurrentState() {
                return {
                    timestamp: Date.now(),
                    elements: [], // Will be populated with canvas elements
                    version: '1.0'
                };
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 right-6 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in';
                notification.innerHTML = `
                    <div class="flex items-center gap-2">
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        <span class="text-sm font-semibold">${message}</span>
                    </div>
                `;
                document.body.appendChild(notification);
                lucide.createIcons();
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-10px)';
                    setTimeout(() => notification.remove(), 300);
                }, 2000);
            }

            updateLastSavedTime() {
                const timeAgo = this.getTimeAgo(this.lastSaved);
                const metaValue = document.querySelector('[data-meta="last-saved"]');
                if (metaValue) {
                    metaValue.textContent = timeAgo;
                }
            }

            getTimeAgo(timestamp) {
                const seconds = Math.floor((Date.now() - timestamp) / 1000);
                if (seconds < 60) return 'เมื่อสักครู่';
                if (seconds < 3600) return `${Math.floor(seconds / 60)} นาทีที่แล้ว`;
                return `${Math.floor(seconds / 3600)} ชั่วโมงที่แล้ว`;
            }
        }

        const autoSave = new AutoSaveManager();

        // ========================================
        // 📏 SMART GUIDES & SNAPPING SYSTEM
        // ========================================
        class SmartGuidesManager {
            constructor() {
                this.enabled = true;
                this.snapThreshold = 5;
                this.guides = [];
            }

            findSnapPoints(element, allElements) {
                const snapPoints = {
                    x: [],
                    y: []
                };

                allElements.forEach(el => {
                    if (el === element) return;
                    
                    const rect = el.getBoundingClientRect();
                    snapPoints.x.push(rect.left, rect.right, rect.left + rect.width / 2);
                    snapPoints.y.push(rect.top, rect.bottom, rect.top + rect.height / 2);
                });

                return snapPoints;
            }

            snapToGuides(x, y, snapPoints) {
                if (!this.enabled) return { x, y };

                let snappedX = x;
                let snappedY = y;
                const guidesToShow = [];

                // Check X snapping
                for (const snapX of snapPoints.x) {
                    if (Math.abs(x - snapX) < this.snapThreshold) {
                        snappedX = snapX;
                        guidesToShow.push({ type: 'vertical', position: snapX });
                        break;
                    }
                }

                // Check Y snapping
                for (const snapY of snapPoints.y) {
                    if (Math.abs(y - snapY) < this.snapThreshold) {
                        snappedY = snapY;
                        guidesToShow.push({ type: 'horizontal', position: snapY });
                        break;
                    }
                }

                this.showGuides(guidesToShow);
                return { x: snappedX, y: snappedY };
            }

            showGuides(guides) {
                this.clearGuides();
                
                guides.forEach(guide => {
                    const line = document.createElement('div');
                    line.className = 'smart-guide';
                    
                    if (guide.type === 'vertical') {
                        line.style.cssText = `
                            position: absolute;
                            left: ${guide.position}px;
                            top: 0;
                            width: 1px;
                            height: 100%;
                            background: #3973b2;
                            z-index: 9999;
                        `;
                    } else {
                        line.style.cssText = `
                            position: absolute;
                            left: 0;
                            top: ${guide.position}px;
                            width: 100%;
                            height: 1px;
                            background: #3973b2;
                            z-index: 9999;
                        `;
                    }
                    
                    document.getElementById('print-area').appendChild(line);
                    this.guides.push(line);
                });
            }

            clearGuides() {
                this.guides.forEach(guide => guide.remove());
                this.guides = [];
            }

            toggle() {
                this.enabled = !this.enabled;
                if (!this.enabled) this.clearGuides();
                return this.enabled;
            }
        }

        const smartGuides = new SmartGuidesManager();

        // ========================================
        // 🎨 BACKGROUND REMOVAL (Simulated)
        // ========================================
        class BackgroundRemovalTool {
            async removeBackground(imageElement) {
                // In real app, this would call an API like remove.bg
                return new Promise((resolve) => {
                    setTimeout(() => {
                        autoSave.showNotification('ลบพื้นหลังสำเร็จ! (Demo)');
                        resolve(imageElement);
                    }, 1500);
                });
            }
        }

        const bgRemover = new BackgroundRemovalTool();

        // ========================================
        // 💰 PRICING CALCULATOR
        // ========================================
        class PricingCalculator {
            constructor() {
                this.baseCost = 150; // Base t-shirt cost
                this.printCost = 50; // Print cost
                this.shippingCost = 40;
            }

            calculate() {
                const totalCost = this.baseCost + this.printCost + this.shippingCost;
                const suggestedPrice = totalCost * 2; // 100% markup
                const profit = suggestedPrice - totalCost;
                const margin = ((profit / suggestedPrice) * 100).toFixed(1);

                return {
                    cost: totalCost,
                    suggestedPrice,
                    profit,
                    margin
                };
            }

            showCalculator() {
                const pricing = this.calculate();
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                                <i data-lucide="calculator" class="w-6 h-6 text-ci-blue"></i>
                                คำนวณราคา
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="p-2 hover:bg-slate-100 rounded-lg">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-slate-50 rounded-xl p-4">
                                <h4 class="text-sm font-semibold text-slate-600 mb-3">ต้นทุน</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>เสื้อ:</span>
                                        <span class="font-semibold">${this.baseCost} ฿</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>พิมพ์:</span>
                                        <span class="font-semibold">${this.printCost} ฿</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>จัดส่ง:</span>
                                        <span class="font-semibold">${this.shippingCost} ฿</span>
                                    </div>
                                    <div class="border-t border-slate-200 pt-2 mt-2 flex justify-between font-bold">
                                        <span>รวม:</span>
                                        <span class="text-ci-blue">${pricing.cost} ฿</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-br from-ci-blue to-ci-dark text-white rounded-xl p-4">
                                <h4 class="text-sm font-semibold mb-3">ราคาแนะนำ</h4>
                                <div class="text-3xl font-bold mb-2">${pricing.suggestedPrice} ฿</div>
                                <div class="flex items-center gap-4 text-sm">
                                    <span>กำไร: ${pricing.profit} ฿</span>
                                    <span>มาร์จิ้น: ${pricing.margin}%</span>
                                </div>
                            </div>

                            <button onclick="this.closest('.fixed').remove()" class="w-full py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl font-bold transition">
                                ตกลง
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                lucide.createIcons();
            }
        }

        const pricingCalc = new PricingCalculator();

        // --- Shared Data (reduces repetition) ---
        const HEADER_META_ITEMS = [
            { icon: 'shirt', label: 'Variant', value: 'T-Shirt · 2 Colors' },
            { icon: 'clock', label: 'Last saved', value: '2 นาทีที่ผ่านมา', dataMeta: 'last-saved' },
            { icon: 'sparkles', label: 'Progress', value: '80% พร้อมขาย' },
        ];

        const COLOR_OPTIONS = [
            { label: 'White', swatch: '#ffffff', isSelected: true },
            { label: 'Black', swatch: '#111827' },
            { label: 'Navy', swatch: '#334155' },
            { label: 'Chili', swatch: '#991b1b' },
            { label: 'Mist', swatch: '#d1d5db' },
            { label: 'เพิ่มสี', type: 'add', badge: '+15' },
        ];

        const SIZE_OPTIONS = [
            { label: 'XS' },
            { label: 'S' },
            { label: 'M', isSelected: true },
            { label: 'L' },
            { label: 'XL' },
        ];

        const createHeaderMetaItem = ({ icon, label, value, dataMeta }) => `
            <div class="meta-item">
                <span class="flex h-10 w-10 items-center justify-center rounded-full bg-white/15">
                    <i data-lucide="${icon}" class="w-5 h-5"></i>
                </span>
                <span>
                    <small class="uppercase tracking-[0.24em] text-[0.62rem]">${label}</small>
                    <strong class="text-sm font-semibold text-white" ${dataMeta ? `data-meta="${dataMeta}"` : ''}>${value}</strong>
                </span>
            </div>
        `;

        const createColorOption = (option) => {
            if (option.type === 'add') {
                return `
                    <button class="flex flex-col items-center gap-1 text-xs font-medium text-ci-blue">
                        <span class="w-10 h-10 rounded-full border-2 border-dashed border-ci-blue flex items-center justify-center text-[11px] font-semibold">${option.badge}</span>
                        ${option.label}
                    </button>
                `;
            }

            const borderClass = option.isSelected ? 'border-ci-blue ring-2 ring-white shadow-md' : 'border-slate-200';
            return `
                <button class="flex flex-col items-center gap-1 text-xs font-medium text-slate-600">
                    <span class="w-10 h-10 rounded-full border-2 ${borderClass}" style="background: ${option.swatch};"></span>
                    ${option.label}
                </button>
            `;
        };

        const createSizeOption = (option) => {
            const baseClass = 'w-14 h-12 rounded-xl border-2 text-sm font-bold transition';
            const activeClass = 'border-ci-blue bg-blue-50 text-ci-blue shadow-sm';
            const inactiveClass = 'border-slate-200 text-slate-500 hover:border-ci-blue hover:text-ci-blue';
            const classes = `${baseClass} ${option.isSelected ? activeClass : inactiveClass}`;
            return `<button class="${classes}">${option.label}</button>`;
        };

        const headerMetaContainer = document.getElementById('header-meta');
        const colorOptionsContainer = document.getElementById('color-options');
        const sizeOptionsContainer = document.getElementById('size-options');

        if (headerMetaContainer) {
            headerMetaContainer.innerHTML = HEADER_META_ITEMS.map(createHeaderMetaItem).join('');
        }
        if (colorOptionsContainer) {
            colorOptionsContainer.innerHTML = COLOR_OPTIONS.map(createColorOption).join('');
        }
        if (sizeOptionsContainer) {
            sizeOptionsContainer.innerHTML = SIZE_OPTIONS.map(createSizeOption).join('');
        }

        lucide.createIcons();

        // --- JavaScript for Tabbed Interface ---

        // Left Panel (Tools)
        const toolNavButtons = document.querySelectorAll('.tool-nav-button');
        const toolPanels = document.querySelectorAll('.tool-panel');

        toolNavButtons.forEach(tab => {
            tab.addEventListener('click', () => {
                // Deactivate all
                toolNavButtons.forEach(t => t.classList.remove('active'));
                toolPanels.forEach(p => p.classList.remove('active'));
                
                // Activate clicked
                tab.classList.add('active');
                const panel = document.getElementById('panel-' + tab.dataset.tab);
                if (panel) {
                    panel.classList.add('active');
                }
            });
        });
        
        // [NEW] Set default active tab (Text)
        // (This is now done with 'active' class in HTML for simplicity)


        // Center Canvas (Views)
        const viewTabs = document.querySelectorAll('.view-tab');
        const mockupImage = document.getElementById('mockup-image');
        
        const mockupViews = {
            front: 'https://placehold.co/800x1000/ffffff/f1f5f9?text=+',
            back: 'https://placehold.co/800x1000/ffffff/f1f5f9?text=Back'
        };

        viewTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                viewTabs.forEach(t => t.classList.remove('active', 'font-bold', 'text-slate-500', 'font-medium'));
                viewTabs.forEach(t => t.classList.add('text-slate-500', 'font-medium')); // Reset all
                
                tab.classList.add('active', 'font-bold');
                tab.classList.remove('text-slate-500', 'font-medium');
                
                const view = tab.dataset.view;
                mockupImage.src = mockupViews[view];
                mockupImage.alt = `T-Shirt Mockup ${view}`;
            });
        });

        // --- [NEW] Context Toolbar & Right Panel Logic ---
        const designElement = document.getElementById('design-element');
        const contextToolbar = document.getElementById('context-toolbar-main');
        const welcomeBar = document.getElementById('canvas-welcome-bar');
    const layerProperties = document.getElementById('layer-properties');
    const canvas = document.querySelector('.canvas-layout'); 
    const layerItem1 = document.getElementById('layer-item-1');
    const layerItem2 = document.getElementById('layer-item-2');
        const rightPanelTabs = document.querySelectorAll('.right-panel-tab');
        const rightPanelSections = document.querySelectorAll('.right-panel-section');
    const layerItems = [layerItem1, layerItem2].filter(Boolean);

        // [NEW] Richer properties HTML (from target image)
        // [CHANGED] Re-structured into a cleaner ACCORDION layout
        const textPropertiesHTML = `
            <h3 class="text-base font-bold text-slate-800 mb-2 flex items-center">
                <i data-lucide="type" class="w-5 h-5 mr-2 text-slate-400"></i>
                คุณสมบัติข้อความ (Text)
            </h3>
            
            <!-- Accordion 1: Content (Start Open) -->
            <div class="property-accordion">
                <button class="accordion-header active">
                    <span><i data-lucide="file-text" class="w-4 h-4 mr-2 text-ci-blue"></i>ข้อความ (Content)</span>
                    <i data-lucide="chevron-down" class="accordion-icon w-5 h-5 rotate-180"></i>
                </button>
                <div class="accordion-content open" style="max-height: 500px;"> <!-- Inline style to start open -->
                    <textarea rows="3" class="property-input mt-3">NEW DAY</textarea>
                </div>
            </div>

            <!-- Accordion 2: Style & Spacing -->
            <div class="property-accordion">
                <button class="accordion-header">
                    <span><i data-lucide="palette" class="w-4 h-4 mr-2 text-ci-blue"></i>สไตล์และระยะห่าง (Style)</span>
                    <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                </button>
                <div class="accordion-content">
                    <!-- Style -->
                    <div class="pt-3 space-y-2">
                        <label class="property-label">สี (Color)</label>
                        <div class="flex items-center gap-3">
                            <input type="color" value="#334155" class="property-color-input">
                            <input type="text" value="#334155" class="property-input font-mono">
                        </div>
                    </div>
                    <!-- Spacing -->
                    <div class="property-section space-y-4">
                        <label class="property-label">ระยะห่าง (Spacing)</label>
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs text-slate-500">Letter Spacing</span>
                                <span class="text-sm font-medium text-slate-700">0</span>
                            </div>
                            <input type="range" class="w-full" min="-20" max="100" value="0">
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs text-slate-500">Line Height</span>
                                <span class="text-sm font-medium text-slate-700">1.2</span>
                            </div>
                            <input type="range" class="w-full" min="0.8" max="3" value="1.2" step="0.1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accordion 3: Transform -->
            <div class="property-accordion">
                <button class="accordion-header">
                    <span><i data-lucide="move" class="w-4 h-4 mr-2 text-ci-blue"></i>การแปลง (Transform)</span>
                    <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                </button>
                <div class="accordion-content">
                    <div class="pt-3 space-y-3">
                        <div class="property-input-group">
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Width</label>
                                <input type="text" value="150" class="property-input">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Height</label>
                                <input type="text" value="45" class="property-input">
                            </div>
                        </div>
                        <div class="property-input-group">
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Position left (X)</label>
                                <input type="text" value="26.06" class="property-input">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Position top (Y)</label>
                                <input type="text" value="36.2" class="property-input">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">Rotate</label>
                            <div class="relative">
                                <input type="number" value="0" class="property-input">
                                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-sm text-slate-400">deg</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accordion 4: Effects -->
            <div class="property-accordion">
                <button class="accordion-header">
                    <span><i data-lucide="wand-2" class="w-4 h-4 mr-2 text-ci-blue"></i>เอฟเฟกต์ (Effects)</span>
                    <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                </button>
                <div class="accordion-content">
                    <div class="pt-3 space-y-4">
                        <!-- Curve -->
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">Curved Text</label>
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs text-slate-500">Curve</span>
                                <span class="text-sm font-medium text-slate-700">14 %</span>
                            </div>
                            <input type="range" class="w-full" min="-100" max="100" value="14">
                        </div>
                        <!-- Outline -->
                        <div class="pt-4 border-t border-slate-100">
                            <div class="flex justify-between items-center mb-3">
                                <label class="block text-sm font-bold text-slate-700">ขอบ (Outline)</label>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <!-- More outline controls can be hidden until switch is on -->
                        </div>
                        <!-- Shadow -->
                        <div class="pt-4 border-t border-slate-100">
                            <div class="flex justify-between items-center mb-3">
                                <label class="block text-sm font-bold text-slate-700">เงา (Shadow)</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <!-- More shadow controls can be hidden until switch is on -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accordion 5: Alignment -->
            <div class="property-accordion">
                <button class="accordion-header">
                    <span><i data-lucide="align-center" class="w-4 h-4 mr-2 text-ci-blue"></i>การจัดตำแหน่ง (Alignment)</span>
                    <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                </button>
                <div class="accordion-content">
                    <div class="pt-3 grid grid-cols-6 gap-1">
                        <button class="p-2 border border-slate-200 rounded-lg hover:bg-slate-100"><i data-lucide="align-horizontal-justify-start" class="w-5 h-5 m-auto"></i></button>
                        <button class="p-2 border border-slate-200 rounded-lg hover:bg-slate-100"><i data-lucide="align-horizontal-justify-center" class="w-5 h-5 m-auto"></i></button>
                        <button class="p-2 border border-slate-200 rounded-lg hover:bg-slate-100"><i data-lucide="align-horizontal-justify-end" class="w-5 h-5 m-auto"></i></button>
                        <button class="p-2 border border-slate-200 rounded-lg hover:bg-slate-100"><i data-lucide="align-vertical-justify-start" class="w-5 h-5 m-auto"></i></button>
                        <button class="p-2 border border-slate-200 rounded-lg hover:bg-slate-100"><i data-lucide="align-vertical-justify-center" class="w-5 h-5 m-auto"></i></button>
                        <button class="p-2 border border-slate-200 rounded-lg hover:bg-slate-100"><i data-lucide="align-vertical-justify-end" class="w-5 h-5 m-auto"></i></button>
                    </div>
                </div>
            </div>

            <!-- Delete (remains at bottom, outside accordions) -->
            <div class="property-section">
                <button class="w-full py-2.5 text-sm font-medium text-rose-600 bg-rose-50 rounded-xl hover:bg-rose-100 transition-all flex items-center justify-center">
                    <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i> ลบเลเยอร์นี้
                </button>
            </div>
        `;
        
        const imagePropertiesHTML = `
            <h3 class="text-base font-bold text-slate-800 mb-2 flex items-center">
                <i data-lucide="image" class="w-5 h-5 mr-2 text-slate-400"></i>
                คุณสมบัติรูปภาพ (Image)
            </h3>
            <div class="property-accordion">
                <button class="accordion-header active">
                    <span><i data-lucide="folder-open" class="w-4 h-4 mr-2 text-ci-blue"></i>ไฟล์และข้อมูล</span>
                    <i data-lucide="chevron-down" class="accordion-icon w-5 h-5 rotate-180"></i>
                </button>
                <div class="accordion-content open" style="max-height: 500px;">
                    <div class="space-y-3 mt-3 text-sm text-slate-600">
                        <div class="flex items-center justify-between">
                            <span>ไฟล์</span>
                            <button class="text-xs font-semibold text-ci-blue hover:underline">แทนที่</button>
                        </div>
                        <div class="rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs">
                            <p class="font-semibold text-slate-700">Your-Design.png</p>
                            <p class="text-slate-500">PNG · 300 DPI · 4.2 MB</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="property-accordion">
                <button class="accordion-header">
                    <span><i data-lucide="maximize" class="w-4 h-4 mr-2 text-ci-blue"></i>การปรับขนาด</span>
                    <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                </button>
                <div class="accordion-content">
                    <div class="property-input-group mt-3">
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">กว้าง (cm)</label>
                            <input type="text" value="18" class="property-input">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">สูง (cm)</label>
                            <input type="text" value="12" class="property-input">
                        </div>
                    </div>
                    <div class="property-section space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-slate-500">ล็อกอัตราส่วน</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div>
                            <label class="property-label">ครอปพื้นที่พิมพ์</label>
                            <input type="range" min="0" max="100" value="10" class="w-full">
                        </div>
                    </div>
                </div>
            </div>
            <div class="property-accordion">
                <button class="accordion-header">
                    <span><i data-lucide="wand-2" class="w-4 h-4 mr-2 text-ci-blue"></i>ปรับแต่งเอฟเฟกต์</span>
                    <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                </button>
                <div class="accordion-content">
                    <div class="space-y-4 mt-3">
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-slate-500">ความทึบ</span>
                            <span class="text-sm font-medium text-slate-700">85%</span>
                        </div>
                        <input type="range" min="0" max="100" value="85" class="w-full">
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-slate-500">โหมดผสม</span>
                            <select class="property-input">
                                <option>Normal</option>
                                <option>Multiply</option>
                                <option>Screen</option>
                                <option>Overlay</option>
                            </select>
                        </div>
                        <div class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-3 text-xs text-slate-600">
                            เคล็ดลับ: ลดความทึบสำหรับพื้นหลังเพื่อไม่ให้แย่งจุดเด่นของข้อความ
                        </div>
                    </div>
                </div>
            </div>
            <div class="property-section">
                <button class="w-full py-2.5 text-sm font-medium text-rose-600 bg-rose-50 rounded-xl hover:bg-rose-100 transition-all flex items-center justify-center">
                    <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i> ลบรูปภาพนี้
                </button>
            </div>
        `;

        // [NEW] Updated placeholder HTML with a helpful guide
        const placeholderPropertiesHTML = `
            <div class="bg-slate-50 border border-slate-200 rounded-xl p-5">
                <h3 class="text-base font-bold text-slate-800 mb-4 flex items-center">
                    <i data-lucide="wand-2" class="w-5 h-5 mr-2 text-ci-blue"></i>
                    เริ่มออกแบบที่นี่
                </h3>
                <ul class="space-y-3 text-sm text-slate-600">
                    <li class="flex items-center">
                        <i data-lucide="shirt" class="w-4 h-4 mr-3 text-slate-400 flex-shrink-0"></i>
                        <span>เลือก <b>สินค้า</b> และ <b>สีเสื้อ</b> ที่แท็บด้านซ้าย</span>
                    </li>
                    <li class="flex items-center">
                        <i data-lucide="type" class="w-4 h-4 mr-3 text-slate-400 flex-shrink-0"></i>
                        <span>เพิ่ม <b>ข้อความ</b> หรือ <b>อัปโหลด</b> ลายของคุณ</span>
                    </li>
                    <li class="flex items-center">
                        <i data-lucide="mouse-pointer-click" class="w-4 h-4 mr-3 text-slate-400 flex-shrink-0"></i>
                        <span><b>คลิก</b> ที่ชิ้นงานบนเสื้อเพื่อเริ่มแก้ไข</span>
                    </li>
                </ul>
                <div class="mt-5 grid grid-cols-2 gap-3 text-xs">
                    <button class="flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 font-semibold text-slate-600 hover:border-ci-blue hover:text-ci-blue transition">
                        <i data-lucide="type" class="w-4 h-4"></i>
                        เพิ่มข้อความ
                    </button>
                    <button class="flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 font-semibold text-slate-600 hover:border-ci-blue hover:text-ci-blue transition">
                        <i data-lucide="layout-template" class="w-4 h-4"></i>
                        เลือกเทมเพลต
                    </button>
                </div>
            </div>
            <div class="mt-4 text-center">
                <span class="text-xs text-slate-400">Powered by Anajak T-Shirt</span>
            </div>
        `;

        const activateRightPanelSection = (panel) => {
            if (!panel) return;
            rightPanelTabs.forEach(tab => {
                const isActive = tab.dataset.rightPanel === panel;
                tab.classList.toggle('active', isActive);
            });
            rightPanelSections.forEach(section => {
                const isActive = section.id === `right-panel-${panel}`;
                section.classList.toggle('active', isActive);
            });
            if (panel !== 'properties') {
                if (contextToolbar) {
                    contextToolbar.classList.add('hidden');
                }
                if (welcomeBar) {
                    welcomeBar.classList.remove('hidden');
                }
                layerItems.forEach(item => {
                    item.classList.remove('bg-ci-blue/10', 'border-ci-blue/20', 'font-bold');
                    item.classList.add('bg-slate-50', 'border-slate-200');
                });
            }
        };

        if (layerProperties) {
            layerProperties.innerHTML = placeholderPropertiesHTML;
            lucide.createIcons();
        }

        if (rightPanelTabs.length) {
            rightPanelTabs.forEach(tab => {
                tab.addEventListener('click', () => activateRightPanelSection(tab.dataset.rightPanel));
            });
            activateRightPanelSection('overview');
        }

        const showProperties = (e, template = textPropertiesHTML, highlightTarget = layerItem1) => {
            e.stopPropagation(); // Stop click from bubbling up
            if (welcomeBar) {
                welcomeBar.classList.add('hidden');
            }
            if (contextToolbar) {
                contextToolbar.classList.remove('hidden');
            }
            layerProperties.innerHTML = template; // Show properties
            lucide.createIcons(); // Re-render icons
            activateRightPanelSection('properties');
            
            // Highlight layer
            layerItems.forEach(item => {
                item.classList.remove('bg-ci-blue/10', 'border-ci-blue/20', 'font-bold', 'bg-slate-100');
                item.classList.add('bg-slate-50', 'border-slate-200');
            });
            if (highlightTarget) {
                highlightTarget.classList.add('bg-ci-blue/10', 'border-ci-blue/20', 'font-bold');
                highlightTarget.classList.remove('bg-slate-50', 'border-slate-200');
            }
            // ... (un-highlight other layers in a real app)

            // [NEW] Add Accordion Listeners
            const accordionHeaders = layerProperties.querySelectorAll('.accordion-header');
            accordionHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.accordion-icon');

                    header.classList.toggle('active');
                    icon.classList.toggle('rotate-180');
                    
                    if (content.classList.contains('open')) {
                        content.style.maxHeight = '0';
                        content.classList.remove('open');
                    } else {
                        // Set max-height to its scroll height to animate open
                        content.style.maxHeight = content.scrollHeight + 'px';
                        content.classList.add('open');
                    }
                });
            });
        };

        const hideProperties = (e) => {
             // Check if the click is outside the toolbar and the element
            const outsideToolbar = !contextToolbar || !contextToolbar.contains(e.target);
            const outsideElement = !designElement || !designElement.contains(e.target);

            if (outsideToolbar && outsideElement) {
                if (contextToolbar) {
                    contextToolbar.classList.add('hidden');
                }
                if (welcomeBar) {
                    welcomeBar.classList.remove('hidden');
                }
                layerProperties.innerHTML = placeholderPropertiesHTML; // Hide properties
                lucide.createIcons(); // [NEW] Render icons for the placeholder
                activateRightPanelSection('overview');
                
                // Un-highlight layers
                layerItems.forEach(item => {
                    item.classList.remove('bg-ci-blue/10', 'border-ci-blue/20', 'font-bold');
                    item.classList.add('bg-slate-50', 'border-slate-200');
                });
            }
        };

        if (designElement) {
            designElement.addEventListener('click', (event) => showProperties(event, textPropertiesHTML, layerItem1));
        }
        if (canvas) {
            canvas.addEventListener('click', hideProperties);
        }
        if (layerItem1) {
             layerItem1.addEventListener('click', (event) => showProperties(event, textPropertiesHTML, layerItem1));
        }
        if (layerItem2) {
            layerItem2.addEventListener('click', (event) => showProperties(event, imagePropertiesHTML, layerItem2));
        }
        // ... (Add click listener for layerItem2 to show image properties)


        // --- Draggable Demo (Simple) ---
        let isDragging = false;
        let offsetX, offsetY;

        if (designElement) {
            designElement.addEventListener('mousedown', (e) => {
                // Ignore clicks on resize handles
                if (e.target.classList.contains('resize-handle')) return;

                isDragging = true;
                offsetX = e.clientX - designElement.getBoundingClientRect().left;
                offsetY = e.clientY - designElement.getBoundingClientRect().top;
                designElement.style.cursor = 'grabbing';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const printArea = document.getElementById('print-area');
                const parentRect = printArea.getBoundingClientRect();

                let x = e.clientX - parentRect.left - offsetX;
                let y = e.clientY - parentRect.top - offsetY;

                x = Math.max(0, Math.min(x, parentRect.width - designElement.offsetWidth));
                y = Math.max(0, Math.min(y, parentRect.height - designElement.offsetHeight));

                designElement.style.left = `${x}px`;
                designElement.style.top = `${y}px`;
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                if(designElement) {
                    designElement.style.cursor = 'move';
                }
            });
        }
    </script>
</body>
</html>